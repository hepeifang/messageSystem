jBud.define("message/view",["swfupload"],function(a,b,c){var d=function(){this.baseId="MSG"+Math.floor(99999*Math.random()),this.head={small:"http://tpic.home.news.cn/userIcon/s/",middle:"http://tpic.home.news.cn/userIcon/m/",large:"http://tpic.home.news.cn/userIcon/l/"},this.styles={base:"BASESTYLE",skin:"SKIN"},this.selector={message:"message",panel:"panel",panelTitle:"panelTitle",panelContent:"panelContent",panelTop:"panelTop",panelSearch:"panelSearch",panelSearchResult:"panelSearchResult",panelCreateTalk:"panelCreateTalk",panelFunc:"panelFunc",panelList:"panelList",panelFriend:"panelFriend",panelFriendOnline:"panelFriendOnline",panelTreeNode:"panelTreeNode",panelTalk:"panelTalk",panelTalkList:"panelTalkList",panelRecent:"panelRecent",panelRecentList:"panelRecentList",tray:"tray",trayTip:"trayTip",trayState:"trayState",traySkin:"traySkin",traySkinSelect:"traySkinSelect",traySkinList:"traySkinList",trayMessage:"trayMessage",chat:"chat",chatTitle:"chatTitle",chatPanel:"chatPanel",talk:"talk",talkTitle:"talkTitle",talkSelected:"talkSelected",talkMax:"talkMax",talkTree:"talkTree",talkPool:"talkPool",talkName:"talkName",preview:"preview",previewContent:"previewContent",previewImage:"previewImage"},this.css={TRAY_OFFLINE:"_OFFLINE_",TRAY_ONLINE:"_ONLINE_",TREE_TITLE:"_MPL-TREE-TITLE_"},this.nodes={}};jBud.extend(d.prototype,{getBaseId:function(){return this.baseId},getHead:function(){return this.head},getStyleId:function(a){return"string"!=typeof a?void 0:this.styles[a]},node:function(a){var b=this.nodes;return a in b?b[a]:b[a]=jBud(a)},get:function(a,b){var c=this.selector;return"string"!=typeof b&&(b=""),c[a]?this.node("#"+this.baseId+c[a]+b):void 0},reload:function(a,b){var c=this.selector;if("string"!=typeof b&&(b=""),!c[a])return void 0;var d="#"+this.baseId+c[a]+b;return delete this.nodes[d],this.get(a,b)},clear:function(){delete this.nodes,this.nodes={}},style:function(a,b){return this.css[a]?(b?".":"")+this.css[a]:""},parseFloat:function(a){return parseFloat(a)||0},renderFramework:function(){var c,a=this.baseId,b=this.selector;return c='<div id="'+a+b.message+'" class="_MESSAGE_">',c+=this.renderPanel(),c+=this.renderTray(),c+="</div>"},renderPanel:function(){var c,d,e,a=this.baseId,b=this.selector;return c='<div id="'+a+b.panel+'" class="_MESSAGE-PANEL_">',d='<div id="'+a+b.panelTitle+'"class="_MP-TITLE_ _MSKIN-BAR_">\u70ab\u804a<ul class="_MBTN-WINDOW_ _MCLEARFIX_"><li class="_MBTN-WCLOSE_">&nbsp;</li></ul></div>',e='<div id="'+a+b.panelContent+'" class="_MP-CONTENT_">',e+='<ul class="_MP-TOP_ _MCLEARFIX_" id="'+a+b.panelTop+'"><li class="_MP-SEARCH_"><ul class="_MP-SEARCH-ITEM_ _MCLEARFIX_"><li class="_MP-SEARCH-INPUT_"><input type="text" id="'+a+b.panelSearch+'"/><div class="_MP-SEARCH-RESULT_ _MHIDDEN_" id="'+a+b.panelSearchResult+'"></div></li><li class="_MP-SEARCH-BUTTON_">&nbsp;</li></ul></li><li class="_MP-TALK_" id="'+a+b.panelCreateTalk+'">\u521b\u5efa\u7ec4</li></ul>',e+='<ul class="_MP-FUNC_ _MCLEARFIX_" id="'+a+b.panelFunc+'"><li class="_MPF-LATEST_" title="\u6700\u8fd1\u8054\u7cfb\u4eba"><span class="_MPF-LATEST-TIP_" id="_MPF-LATEST-TIP_">&nbsp;</span></li><li class="_MPF-FRIEND_" title="\u597d\u53cb">&nbsp;</li><li class="_MPF-TALK_" title="\u8ba8\u8bba\u7ec4">&nbsp;</li></ul>',e+='<div class="_MP-LIST_"><ul class="_MP-LAYER_ _MCLEARFIX_" id="'+a+b.panelList+'"><li id="'+a+b.panelRecent+'"></li><li id="'+a+b.panelFriend+'"></li><li id="'+a+b.panelTalk+'"></li></ul></div>',e+="</div>",c+=d+e,c+="</div>"},renderTray:function(){var c,a=this.baseId,b=this.selector;return c='<ul id="'+a+b.tray+'"class="_MESSAGE-TRAY_ _MCLEARFIX_ _MSKIN-BAR_"><li class="_MT-STATE_ _OFFLINE_" id="'+a+b.trayState+'">&nbsp;</li><li class="_MT-MESSAGE_" id="'+a+b.trayMessage+'">\u70ab\u804a<em id="'+a+b.trayTip+'"></em></li><li class="_MT-SKIN_" id="'+a+b.traySkin+'"><div class="_MT-SKIN-SELECT_ _MHIDDEN_" id="'+a+b.traySkinSelect+'"><ul class="_MT-SKIN-LIST_ _MCLEARFIX_" id="'+a+b.traySkinList+'"></ul><div class="_MT-SKIN-ARROW_">&nbsp;</div></div></li></ul>'},renderFriendTree:function(a){if(!a)return"";var d,b=this.baseId,c=this.selector;d='<div class="_MPL-TREE-ONLINE_"><input type="checkbox" id="'+b+c.panelFriendOnline+'"/>\u53ea\u663e\u793a\u5728\u7ebf\u597d\u53cb</div>',d+='<div class="_MPL-TREE_">',d+=this.renderFriendTreeNode(a.root);for(var e=0;e<a.length;e++)d+=this.renderFriendTreeNode(a[e]);return d+="</div>"},renderFriendTreeNode:function(a){if(!a)return"";var d,b=this.baseId,c=this.selector;return d='<div class="_MPL-TREE-ITEM_">',d+='<div class="_MPL-TREE-TITLE_" id="'+b+c.panelTreeNode+a.groupId+'">'+a.groupName+"</div>",d+=this.renderFriendList(a.groupMember,a),d+="</div>"},renderFriendList:function(a,b){if(!a)return"";var f;this.baseId,this.selector,this.head,f='<div class="_MPL-LIST_ _MHIDDEN_">';for(var g in a){var h=a[g];f+=this.renderFriend(h,b)}return f+="</div>"},renderFriend:function(a,b){if(!a)return"";var f,c=this.baseId,e=(this.selector,this.head),g=a.online?"_ONLINE_":"_OFFLINE_",h=a.online?"":"_MPL-OFFLINE_",i="",j="",k="",l="";return b&&(("RECENT"==b||"ROOT"==b.groupId)&&(i=c+a.userId+"FRIENDTIP"),"RECENT"==b?j='id="'+c+a.userId+'RECENT-FRIEND"':l=c+a.userId+"TREE-FRIEND"),k=c+a.userId+"FRIEND-ICON",f='<div class="'+l+" _MPL-LIST-ITEM_ "+h+'" '+j+'><a class="_MPL-ICON_"><img src="'+(e.small+a.userName)+'" class=" '+g+" "+k+'"/><em class="_MHIDDEN_ '+i+'"></em></a><a class="_MPL-NAME_" data-type="1" data-id="'+a.userId+'">'+a.nickName+"</a></div>"},renderTalkList:function(a){var e,b=this.baseId,c=this.selector;if(this.head,!a||!a.groupInfo)return'<div class="_MPL-LIST_" id="'+b+c.panelTalkList+'"></div>';e='<div class="_MPL-LIST_" id="'+b+c.panelTalkList+'">';for(var f=0;f<a.groupInfo.length;f++){var g=a.groupInfo[f];e+=this.renderTalk(g)}return e+="</div>"},renderTalk:function(a,b){if(!a)return"";var f,c=this.baseId;this.selector,this.head;var g=c+a.g_id+"TALKTIP",h="",i="",j="";return"RECENT"==b?h='id="'+c+a.g_id+'RECENT-TALK"':(h='id="'+c+a.g_id+'PANEL-TALK"',i='<input type="text" class="_MPL-NAME-EDIT_ _MHIDDEN_" data-id="'+a.g_id+'" data-type="2"/><a class="_MPL-EDIT_" data-id="'+a.g_id+'" data-type="2" title="Esc\u53d6\u6d88 Enter\u786e\u8ba4">&nbsp;</a>'),j=c+a.g_id+"TALK-NAME",f='<div class="_MPL-LIST-ITEM_" '+h+'><a class="_MPL-ICON_ _MICON-TALK_">&nbsp;<em class="_MHIDDEN_ '+g+'"></em></a><a class="_MPL-NAME_ '+j+'" data-type="2" data-id="'+a.g_id+'">'+a.title+"</a>"+i+"</div>"},renderRecentList:function(a){if(!a||!a.userInfo)return"";var d,b=this.baseId,c=this.selector;d='<div class="_MPL-LIST_" id="'+b+c.panelRecentList+'">';for(var e=0;e<a.userInfo.length;e++){var f=a.userInfo[e];1==f.type?d+=this.renderFriend(f.target,"RECENT"):2==f.type&&(d+=this.renderTalk(f.target,"RECENT"))}return d+="</div>"},renderChatFramework:function(){var c,a=this.baseId,b=this.selector;c='<div class="_MESSAGE-CHAT_" id="'+a+b.chat+'">';var d='<div class="_MC-TITLE_ _MSKIN-BAR_"><div class="_MC-TAB-MAIN_"><ul class="_MC-TAB_ _MCLEARFIX_" id="'+a+b.chatTitle+'"></ul></div><ul class="_MBTN-WINDOW_ _MCLEARFIX_"><li class="_MBTN-WNARROW_">&nbsp;</li><li class="_MBTN-WCLOSE_">&nbsp;</li></ul></div>',e='<div class="_MC-PANEL_"><div class="_MCP-LAYER_ _MCLEARFIX_" id="'+a+b.chatPanel+'"></div></div>';return c+=d+e,c+="</div>"},renderChatTitleFriend:function(a){if(!a)return"";var e,f,b=this.baseId,d=(this.selector,this.head);return f=b+a.userId+"FRIENDTIP",e='<li id="'+b+a.userId+"CHAT-FRIEND-TITLE"+'"><div class="_MC-TAB-INFO_ _MCLEARFIX_"><h3><img src="'+(d.small+a.userName)+'"/></h3><p class="_MC-TAB-NAME_"  data-id="'+a.userId+'" data-type="1">'+a.nickName+'</p></div><div class="_MC-TAB-CLOSE_"  data-id="'+a.userId+'" data-type="1">&nbsp;</div><div class="_MC-TAB-TIP_ _MHIDDEN_ '+f+'"></div></li>'},renderChatTitleTalk:function(a){if(!a)return"";var e,f,b=this.baseId;return this.selector,this.head,f=b+a.g_id+"TALKTIP",e='<li id="'+b+a.g_id+"CHAT-TALK-TITLE"+'"><div class="_MC-TAB-INFO_ _MCLEARFIX_"><h3 class="_MICON-TALK-TINY_">&nbsp;</h3><p class="_MC-TAB-NAME_" data-id="'+a.g_id+'" data-type="2">'+a.title+'</p></div><div class="_MC-TAB-CLOSE_" data-id="'+a.g_id+'" data-type="2">&nbsp;</div><div class="_MC-TAB-TIP_ _MHIDDEN_ '+f+'"></div></li>'},renderChatPanelFriend:function(a){if(!a)return"";var d,e,f,b=this.baseId;this.selector,e=this.parseFloat(a.offlineCount),f=e>0?"":" _MHIDDEN_ ",e=e>99?99:e,d='<div class="_MCP-LAYER-ITEM_" id="'+b+a.userId+"CHAT-FRIEND-PANEL"+'">';var g='<div class="_MCP-LAYER-MAIN_"  id="'+b+a.userId+"CHAT-FRIEND-MAIN"+'">',h='<div class="_MCPL-CONTENT_" id="'+b+a.userId+"CHAT-FRIEND-CONTENT"+'"><ul class="_MCPL-CONTENT-LIST_" id="'+b+a.userId+"CHAT-FRIEND-BUBBLE"+'"></ul></div>',i='<div class="_MCPL-PUBLISH_">',j='<div class="_MCPL-UPLOAD-TIP_ _MHIDDEN_"  id="'+b+a.userId+"1CHAT-UPLOAD-TIP"+'"></div>',k='<div class="_MCPL-TOOLS_"><ul class="_MBTN-TOOLS_ _MCLEARFIX_"><li class="_MBTN-FACES_"><button class="_MBTN-ICON-FACE_  _MTOOLS-FACE_" title="\u8868\u60c5" data-id="'+a.userId+'" data-type="1">&nbsp;</button><div class="_MBTN-FACES-LAYER_ _MCLEARFIX_ _MHIDDEN_" id="'+b+a.userId+'1FACES-LAYER"></div></li><li class="_MBTN-SWF_" title="\u56fe\u7247"><button class="_MBTN-ICON-IMAGE_ _MTOOLS-IMAGE_" title="\u56fe\u7247" >&nbsp</button><button id="'+b+a.userId+1+"CHAT-IMAGE-UPLOAD"+'" class="_MBTN-SWF-BUTTON_">&nbsp;</button></li><li class="_MBTN-SWF_"  title="\u9644\u4ef6"><button class="_MBTN-ICON-ANNEX_  _MTOOLS-ANNEX_" title="\u9644\u4ef6">&nbsp;</button><button id="'+b+a.userId+1+"CHAT-ANNEX-UPLOAD"+'" class="_MBTN-SWF-BUTTON_">&nbsp;</button></li><li><button class="_MBTN-ICON-USER_ _MTOOLS-TALK_" title="\u521b\u5efa\u8ba8\u8bba\u7ec4"  data-id="'+a.userId+'" data-type="1">&nbsp;</button></li></ul><ul class="_MBTN-DIALOG_ _MCLEARFIX_"><li class="_MINFO-RECORD-BUTTON_"><button class="_MBTN-ICON-GRAY_ _MTOOLS-RECORD_" data-id="'+a.userId+'" data-type="1">\u6d88\u606f\u8bb0\u5f55</button><div class="_MINFO-RECORD-TIP_ '+f+' ">'+e+"</div></li></ul></div>",l='<div class="_MCPL-TEXT_"><textarea placeholder="\u51c6\u5907\u53d1\u51fa\u6d88\u606f\u7684\u5185\u5bb9\uff08Ctrl+Enter\u5feb\u901f\u53d1\u9001\uff09" class="_MPUBLISH-TEXT_"   id="'+b+a.userId+"CHAT-FRIEND-TEXT"+'" data-id="'+a.userId+'" data-type="1"></textarea></div>',m='<div class="_MCPL-SEND_"><h3 id="'+b+a.userId+'CHAT-FRIEND-TEXT-TIP"></h3><div class="_MCPL-SEND-TIP_">Ctrl+Enter\u5feb\u901f\u53d1\u9001</div><ul class="_MBTN-DIALOG_ _MCLEARFIX_"><li><button class="_MBTN-ICON-BUTTON_ _MPUBLISH-POST_" data-id="'+a.userId+'" data-type="1" title="Ctrl+Enter\u5feb\u901f\u53d1\u9001">\u53d1\u9001</button></li></ul></div>';i+=j+k+l+m,i+="</div>";var n='<div class="_MCP-LAYER-INFO_ _MHIDDEN_" id="'+b+a.userId+"CHAT-FRIEND-RECORD"+'"><div class="_MINFO-TITLE_">\u6d88\u606f\u8bb0\u5f55</div><div class="_MINFO-MESSAGE_" id="'+b+a.userId+"CHAT-FRIEND-RECORD-LIST"+'"></div><div class="_MINFO-MESSAGE-SEARCH_"><div class="_MINFO-MSEARCH-PAGE_" data-id="'+a.userId+'" data-type="1"><button class="_MINFO-MSEARCH-LEFT_"  id="'+b+a.userId+"CHAT-FRIEND-RECORD-PREV"+'">&nbsp;</button><input class="_MINFO-MSEARCH-TEXT_"  id="'+b+a.userId+"CHAT-FRIEND-RECORD-TEXT"+'"/>/<span class="_MINFO-MSEARCH-TOTAL_"  id="'+b+a.userId+"CHAT-FRIEND-RECORD-TOTAL"+'"></span><button class="_MINFO-MSEARCH-RIGHT_"  id="'+b+a.userId+"CHAT-FRIEND-RECORD-NEXT"+'">&nbsp;</button></div></div></div>';return g+=h+i,g+="</div>",d+=g+n,d+="</div>"},renderChatPanelTalk:function(a){if(!a)return"";var d,e,f,b=this.baseId;this.selector,e=this.parseFloat(a.offlineCount),f=e>0?"":" _MHIDDEN_ ",e=e>99?99:e,d='<div class="_MCP-LAYER-ITEM_" id="'+b+a.g_id+"CHAT-TALK-PANEL"+'">';var g='<div class="_MCP-LAYER-MAIN_ _MCP-SHOWINFO_" id="'+b+a.g_id+"CHAT-TALK-MAIN"+'">',h='<div class="_MCPL-CONTENT_" id="'+b+a.g_id+"CHAT-TALK-CONTENT"+'"><ul class="_MCPL-CONTENT-LIST_" id="'+b+a.g_id+"CHAT-TALK-BUBBLE"+'"></ul></div>',i='<div class="_MCPL-PUBLISH_">',j='<div class="_MCPL-UPLOAD-TIP_ _MHIDDEN_"  id="'+b+a.g_id+"2CHAT-UPLOAD-TIP"+'"></div>',k='<div class="_MCPL-TOOLS_"><ul class="_MBTN-TOOLS_ _MCLEARFIX_"><li class="_MBTN-FACES_"><button class="_MBTN-ICON-FACE_  _MTOOLS-FACE_" title="\u8868\u60c5" data-id="'+a.g_id+'" data-type="2">&nbsp;</button><div class="_MBTN-FACES-LAYER_ _MCLEARFIX_ _MHIDDEN_" id="'+b+a.g_id+'2FACES-LAYER"></div></li><li  class="_MBTN-SWF_" title="\u56fe\u7247"><button class="_MBTN-ICON-IMAGE_ _MTOOLS-IMAGE_" title="\u56fe\u7247">&nbsp;</button><button id="'+b+a.g_id+2+"CHAT-IMAGE-UPLOAD"+'" class="_MBTN-SWF-BUTTON_">&nbsp;</button></li><li><button class="_MBTN-ICON-USER_ _MTOOLS-TALK_"title="\u6dfb\u52a0\u6210\u5458"  data-id="'+a.g_id+'" data-type="2">&nbsp;</button></li></ul><ul class="_MBTN-DIALOG_ _MCLEARFIX_"><li><button class="_MBTN-ICON-GRAY_ _MTOOLS-TALK-QUIT_"   data-id="'+a.g_id+'" data-type="2">\u9000\u51fa\u8ba8\u8bba</button></li><li  class="_MINFO-RECORD-BUTTON_"><button class="_MBTN-ICON-GRAY_ _MTOOLS-RECORD_"  data-id="'+a.g_id+'" data-type="2">\u6d88\u606f\u8bb0\u5f55</button><div  class="_MINFO-RECORD-TIP_ '+f+'">'+e+"</div></li></ul></div>",l='<div class="_MCPL-TEXT_"><textarea placeholder="\u51c6\u5907\u53d1\u51fa\u6d88\u606f\u7684\u5185\u5bb9\uff08Ctrl+Enter\u5feb\u901f\u53d1\u9001\uff09" class="_MPUBLISH-TEXT_"  id="'+b+a.g_id+"CHAT-TALK-TEXT"+'" data-id="'+a.g_id+'" data-type="2"></textarea></div>',m='<div class="_MCPL-SEND_"><h3 id="'+b+a.g_id+'CHAT-TALK-TEXT-TIP"></h3><div class="_MCPL-SEND-TIP_">Ctrl+Enter\u5feb\u901f\u53d1\u9001</div><ul class="_MBTN-DIALOG_ _MCLEARFIX_"><li><button class="_MBTN-ICON-BUTTON_ _MPUBLISH-POST_" data-id="'+a.g_id+'" data-type="2"  title="Ctrl+Enter\u5feb\u901f\u53d1\u9001">\u53d1\u9001</button></li></ul></div>';i+=j+k+l+m,i+="</div>";var n='<div class="_MCP-LAYER-INFO_"  id="'+b+a.g_id+"CHAT-TALK-MEMBER"+'"><div class="_MINFO-TITLE_" >\u8ba8\u8bba\u7ec4\u6210\u5458(<em  id="'+b+a.g_id+"CHAT-TALK-MEMBER-COUNT"+'"></em>)</div><div class="_MINFO-LIST_"   id="'+b+a.g_id+"CHAT-TALK-MEMBER-LIST"+'"></div></div>',o='<div class="_MCP-LAYER-INFO_  _MHIDDEN_"  id="'+b+a.g_id+"CHAT-TALK-RECORD"+'"><div class="_MINFO-TITLE_">\u6d88\u606f\u8bb0\u5f55</div><div class="_MINFO-MESSAGE_"  id="'+b+a.g_id+"CHAT-TALK-RECORD-LIST"+'"></div><div class="_MINFO-MESSAGE-SEARCH_"><div class="_MINFO-MSEARCH-PAGE_" data-id="'+a.g_id+'" data-type="2"><button class="_MINFO-MSEARCH-LEFT_"   id="'+b+a.g_id+"CHAT-TALK-RECORD-PREV"+'">&nbsp;</button><input class="_MINFO-MSEARCH-TEXT_"   id="'+b+a.g_id+"CHAT-TALK-RECORD-TEXT"+'"/>/<span class="_MINFO-MSEARCH-TOTAL_"   id="'+b+a.g_id+"CHAT-TALK-RECORD-TOTAL"+'"></span><button class="_MINFO-MSEARCH-RIGHT_"   id="'+b+a.g_id+"CHAT-TALK-RECORD-NEXT"+'">&nbsp;</button></div></div></div>';return g+=h+i,g+="</div>",d+=g+n+o,d+="</div>"},renderChatPanelTalkMember:function(a){if(!a||!a.g_members)return"";var e,b=this.baseId,d=(this.selector,this.head);e="";for(var f=0;f<a.g_members.length;f++){var g=a.g_members[f];e+='<div class="_MINFO-LIST-ITEM_" id="'+b+g.userId+'CHAT-TALK-MEMBER-ITEM"><a class="_MINFO-ICON_"><img src="'+(d.small+g.userName)+'"/></a><a class="_MINFO-NAME_">'+g.nickName+"</a></div>"}return e},renderDate:function(a,b){var c=void 0;if(c=jBud.isString(a)||jBud.isNumeric(a)?new Date(parseFloat(a)):a,!jBud.isDate(c)||"Invalid Date"==c)return a;"string"!=typeof b&&(b="yyyy-MM-dd HH:mm:ss");var d={"M+":c.getMonth()+1,"d+":c.getDate(),"H+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"q+":Math.floor((c.getMonth()+3)/3),S:c.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(c.getFullYear()+"").substr(4-RegExp.$1.length)));for(var e in d)new RegExp("("+e+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?d[e]:("00"+d[e]).substr((""+d[e]).length)));return b},renderChatText:function(a){return"string"!=typeof a?"":a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/(\n|\r)/g,"<br/>")},renderChatBubble:function(a){return a?"PULL"==a.method?this.renderChatFromBubble(a):"PUSH"==a.method?this.renderChatToBubble(a):"":""},renderChatFromBubble:function(a){if(!a)return"";var e,f,g,b=this.baseId,d=(this.selector,this.head);return a.defer&&(g=b+a.type+a.fromId+"BUBBLE-DEFER-NAME",f=b+a.type+a.fromId+"BUBBLE-DEFER-HEAD"),e='<li class="_MCLEARFIX_"><div class="_MCPL-BUBBLE_"><div class="_MCPL-ICON_"><img src="'+(d.small+a.userName)+'"   class="'+f+'"/></div><div class="_MCPL-MESSAGE_"><p>'+a.context+'</p><h3>&nbsp;<div class="_MCPL-MESSAGE-NAME_">'+this.renderDate(a.time)+',<span class="'+g+'">'+a.nickName+'</span></div></h3><div class="_MCPL-ARROW_">&nbsp;</div></div></div></li>'},renderChatToBubble:function(a){if(!a)return"";var e,f,g,b=this.baseId,d=(this.selector,this.head);return a.defer&&(f=b+a.type+a.fromId+"BUBBLE-DEFER-NAME",g=b+a.type+a.fromId+"BUBBLE-DEFER-HEAD"),e='<li class="_MCLEARFIX_"><div class="_MCPL-BUBBLE_ _MBUBBLE-RIGHT_"><div class="_MCPL-MESSAGE_"><p>'+a.context+'</p><h3>&nbsp;<div class="_MCPL-MESSAGE-NAME_">'+this.renderDate(a.time)+',<span class="'+f+'">'+a.nickName+'</span></div></h3><div class="_MCPL-ARROW_">&nbsp;</div></div><div class="_MCPL-ICON_"><img src="'+(d.small+a.userName)+'"  class="'+g+'"/></div></div></li>'},renderRecordList:function(a){if(!a)return"";for(var b=a,c="",d=0;d<b.length;d++){var e=b[d];c+='<div class="_MINFO-MESSAGE-ITEM_"><h3>'+e.nickName+"<em>"+this.renderDate(e.time)+"</em></h3><p>"+e.context+"</p></div>"}return c},renderTalkFramework:function(){var c,a=this.baseId,b=this.selector;c='<div class="_MESSAGE-TALKGROUP_" id="'+a+b.talk+'" data-build="true">';var d='<div class="_MTG-TITLE_  _MSKIN-BAR_"><span  id="'+a+b.talkTitle+'">\u521b\u5efa\u8ba8\u8bba\u7ec4</span><ul class="_MBTN-WINDOW_ _MCLEARFIX_"><li class="_MBTN-WCLOSE_ _MTOOLS-CLOSE_">&nbsp;</li></ul></div>',e='<div class="_MTG-PANEL_ _MCLEARFIX_">',f='<div class="_MTG-TREE_"><div class="_MTG-TREE-SEARCH_">\u5168\u90e8\u597d\u53cb\u5217\u8868</div><div class="_MTG-TREE-LAYER_"  id="'+a+b.talkTree+'"></div></div>',g='<div class="_MTG-POOL_"><div class="_MTG-POOL-TITLE_">\u5df2\u9009\u8054\u7cfb\u4eba(<em class="_MTG-POOL-VALUE_"  id="'+a+b.talkSelected+'">0</em>/<em class="_MTG-POOL-MAX_"  id="'+a+b.talkMax+'">0</em>)</div><div class="_MTG-POOL-LAYER_" id="'+a+b.talkPool+'"></div></div>';e+=f+g,e+="</div>";var h='<div class="_MTG-CONTROL_ _MCLEARFIX_"><div class="_MTG-CONTROL-NAME_">\u8ba8\u8bba\u7ec4\u540d\u79f0\uff1a<input type="text"placeholder="\u8bf7\u8f93\u5165\u8ba8\u8bba\u7ec4\u540d\u79f0"  id="'+a+b.talkName+'"/></div><ul class="_MBTN-DIALOG_ _MCLEARFIX_"><li><button class="_MBTN-ICON-BUTTON_ _MTOOLS-SUBMIT_">\u786e\u5b9a</button></li><li><button class="_MBTN-ICON-CANCEL_ _MTOOLS-CLOSE_">\u53d6\u6d88</button></li></ul></div>';return c+=d+e+h,c+="</div>"},renderTalkTree:function(a){if(!a)return"";var d,e;this.baseId,this.selector,d="",e=a.getGroups();for(var f in e){var h,g=e[f];g.isRoot||(h=this.renderTalkTreeList(g.users,a),d+='<div class="_MTG-TREE-ITEM_"><div class="_MTG-TREE-TITLE_">'+g.name+'<a class="_MTG-ADD_ _MTOOLS-GROUP_" data-id="'+f+'">&nbsp;</a></div><div class="_MTG-LIST_ _MHIDDEN_">'+h+"</div></div>")}return d},renderTalkTreeList:function(a,b){if(!a||!b)return"";var f,c=this.baseId,e=(this.selector,this.head);f="";for(var g=0;g<a.length;g++){var i,h=b.getFriend(a[g]);h&&(i=c+h.userId+"TALK-USER",f+='<div class="_MTG-LIST-ITEM_ '+i+'"><a class="_MTG-ICON_"><img src="'+(e.small+h.userName)+'"/></a><a class="_MTG-NAME_ _MTOOLS-USER_" data-id="'+h.userId+'" title="'+h.nickName+'">'+h.nickName+"</a></div>")}return f},renderTalkPoolItem:function(a,b){if(!a)return"";var f,g,c=this.baseId,e=(this.selector,this.head);return g=b?"":'<a class="_MTG-REMOVE_ _MTOOLS-REMOVE_" data-id="'+a.userId+'">&nbsp;</a>',f='<div class="_MTG-LIST_" id="'+c+a.userId+'TALK-POOL" data-id="'+a.userId+'"><div class="_MTG-LIST-ITEM_"><a class="_MTG-ICON_"><img src="'+(e.small+a.userName)+'"/></a><a class="_MTG-NAME_">'+a.nickName+"</a>"+g+"</div></div>"},renderImageUpload:function(a){var c={callback:function(){},uploadType:"photo",uploadUrl:void 0,flashUrl:void 0,targetId:void 0,sizeLimit:"200 KB",types:"*.jpg;*.gif;*.png;*.bmp"};return c.done=function(a,b){switch(a){case 401:break;case 402:c.callback(a,"\u4e00\u6b21\u53ea\u80fd\u4e0a\u4f20\u4e00\u5f20\u56fe\u7247\u54e6~");break;case 403:c.callback(a,"\u56fe\u7247\u5927\u5c0f\u53ea\u80fd\u5728200 KB\u8303\u56f4\u5185\u54e6\uff0c\u5e76\u4e14\u53ea\u80fd\u4e0a\u4f20JPG|PNG|GIF|BMP\u7684\u56fe\u7247\u54e6~");break;case 404:c.callback(a,"\u56fe\u7247\u4e0a\u4f20\u5931\u8d25");break;case 200:c.callback(a,b);break;case 201:c.callback(a,"\u6b63\u5728\u4e0a\u4f20...")}},jBud.extend(c,a),this.renderUpload(c)},renderAnnexUpload:function(a){var c={callback:function(){},uploadType:"file",uploadUrl:void 0,flashUrl:void 0,targetId:void 0,sizeLimit:"2 MB",types:"*.doc;*.docx;*.xls;*.xlsx;*.txt;*.ppt;*.pptx;*.zip;*.rar;*.tar;*.tar.gz"};return c.done=function(a,b){switch(a){case 401:break;case 402:c.callback(a,"\u4e00\u6b21\u53ea\u80fd\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\u54e6~");break;case 403:c.callback(a,"\u6587\u4ef6\u5927\u5c0f\u53ea\u80fd\u57282 MB\u8303\u56f4\u5185\u54e6\uff0c\u5e76\u4e14\u53ea\u80fd\u4e0a\u4f20 doc|docx|xls|xlsx|txt|ppt|pptx|zip|rar|tar|tar.gz \u7684\u6587\u4ef6\u54e6~");break;case 404:c.callback(a,"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25");break;case 200:c.callback(a,b);break;case 201:c.callback(a,"\u6b63\u5728\u4e0a\u4f20...")}},jBud.extend(c,a),this.renderUpload(c)},renderUpload:function(a){var b=[],c={done:function(){},uploadType:void 0,uploadUrl:void 0,flashUrl:void 0,targetId:void 0,sizeLimit:void 0,queueLimit:1,types:void 0};jBud.extend(c,a);var d=function(){for(;b.length>0;)this.cancelUpload(b.shift(),!1)},e=function(a,b){return 0>=a?(c.done(401),void 0):a>1?(c.done(402),void 0):1==a&&0==b?(c.done(403),void 0):(c.done(201),this.startUpload(),void 0)},f=function(){this.setButtonDisabled(!0);var b=jBud("#"+this.movieName).prev("button");return"photo"==c.uploadType?b.addClass("_MBTN-ICON-IMAGE-GREY_"):b.addClass("_MBTN-ICON-ANNEX-GREY_"),!0},g=function(a,b){-270!=b&&c.done(404)},h=function(a,b){var e=a.filestatus;e==SWFUpload.FILE_STATUS.COMPLETE?c.done(200,jBud.parseJSON(b)):c.done(404),this.setButtonDisabled(!1);var f=jBud("#"+this.movieName).prev("button");"photo"==c.uploadType?f.removeClass("_MBTN-ICON-IMAGE-GREY_"):f.removeClass("_MBTN-ICON-ANNEX-GREY_")},i=function(a){b.push(a.id)},j={upload_url:c.uploadUrl,flash_url:c.flashUrl,file_size_limit:c.sizeLimit,file_types:c.types,file_queue_limit:c.queueLimit,post_params:{},button_placeholder_id:c.targetId,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,button_width:"30",button_height:"30",prevent_swf_caching:!1,preserve_relative_urls:!1,upload_error_handler:g,upload_success_handler:h,upload_start_handler:f,file_dialog_complete_handler:e,file_queued_handler:i,file_dialog_start_handler:d};return new SWFUpload(j)},renderChatFaces:function(a,b,c,d){if(a){for(var e='<ul class="_MFACE-ICONS_ _MCLEARFIX_">',f=0;f<a.length;f++)e+='<li><img src="'+b+a[f]+'.gif" class="_MFACE-ITEM_" data-id="'+c+'" data-type="'+d+'" data-face="'+a[f]+'" title="'+a[f]+'" alt="'+a[f]+'"/></li>';return e+="</ul>"}},renderFaceFlag:function(a){return a?"[/"+a+"]":""},renderLightToText:function(a,b){if(a&&b)if(a.focus(),document.selection){var c=document.selection.createRange();c.text=b,c.select()}else if(a.selectionStart||"0"==a.selectionEnd){var d=a.selectionStart,e=a.selectionEnd,f=a.scrollTop;a.value=a.value.substring(0,d)+b+a.value.substring(e,a.value.length),f>0&&(a.scrollTop=f),a.selectionStart=a.selectionEnd=d+b.length}else a.value+=b},parseFaces:function(a,b,c){if(!a||!b||!c)return a;for(var d=0;d<b.length;d++){var e=b[d],f=new RegExp("\\[/"+e+"\\]","g");a=a.replace(f,'<img src="'+c+e+'.gif"/>')}return a},renderSearch:function(a){if(!a)return"";var e,f,g,d=(this.baseId,this.selector,this.head);if(f=a.friends,g=a.talks,e='<div class="_MPL-LIST_">',f)for(var h in f){var i=f[h];i&&(e+='<div class="_MPL-LIST-ITEM_ "><a class="_MPL-ICON_"><img src="'+(d.small+i.userName)+'"/></a><a class="_MPL-NAME_" data-id="'+i.userId+'" data-type="1">'+i.nickName+"</a></div>")}if(g)for(var h in g){var j=g[h];j&&(e+='<div class="_MPL-LIST-ITEM_ "><a class="_MPL-ICON_ _MICON-TALK_">&nbsp;</a><a class="_MPL-NAME_" data-id="'+j.g_id+'" data-type="2">'+j.title+"</a></div>")}return e+='<div class="_MPL-LIST-ITEM_ _MPL-LIST-MORE_"><a href="http://my.xuan.news.cn/friend/friendCenter.do?tag=menu-f" target="_blank">\u66f4\u591a\u7cbe\u786e\u641c\u7d22</a></div>',e+="</div>"},getStyle:function(a){var b=this.baseId,c={href:void 0,callback:function(){},id:""};jBud.extend(c,a);var d=document.getElementsByTagName("head")[0],e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=c.href,e.id=b+c.id,d.appendChild(e),c.callback(!0,e.id)},renderSkinBase:function(a,b){var d,c=this.getStyleId("base");return d=jBud("#"+this.baseId+c),d.length>0?jBud.isFunction(b)?b():!0:(this.getStyle({href:a,id:c,callback:function(a){a&&jBud.isFunction(b)&&b()}}),void 0)},renderSkin:function(a,b,c){var e,f,d=this.getStyleId("skin");if(f=b+a+"/message.skin.css",e=jBud("#"+this.baseId+d),e.length>0){if(e.attr("href")==f)return jBud.isFunction(c)?c():!0;e.remove()}this.getStyle({href:f,id:d,callback:function(a){a&&jBud.isFunction(c)&&c()}})},renderSkinList:function(a){if(!a)return"";for(var b=a.skins,c=a.path,d="icon.png",e="",f=0;f<b.length;f++)e+='<li><img class="_MT-SKIN-ITEM_" src="'+c+b[f]+"/"+d+'" data-skin="'+b[f]+'"/></li>';return e},renderPreview:function(){var a=this.baseId,b=this.selector,c='<div class="_MESSAGE-PREVIEW_" id="'+a+b.preview+'"><div class="_MPREVIEW-LAYER_">&nbsp;</div><div class="_MPREVIEW-CONTENT_" id="'+a+b.previewContent+'"><div class="_MPREVIEW-CLOSE_"></div></div></div>';return c}}),c.exports=d});